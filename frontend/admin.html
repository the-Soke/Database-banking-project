<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - Banking System</title>

<style>
:root {
    --bg:#0b0f1a;
    --card:#11162a;
    --panel:#0c1228;
    --blue:#1f6fff;
    --blue-soft:#2a86ff;
    --text:#e6ebff;
    --muted:#8b93b8;
    --success:#22c55e;
    --error:#ef4444;
    --warning:#f59e0b;
}

*{box-sizing:border-box}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,sans-serif;
    padding:24px;
}

.container{
    max-width:1200px;
    margin:auto;
}

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:32px;
}

.header-left{
    display:flex;
    align-items:center;
    gap:16px;
}

.role-badge{
    padding:6px 12px;
    background:linear-gradient(135deg,var(--warning),#fbbf24);
    border-radius:8px;
    font-size:12px;
    font-weight:700;
    color:#000;
}

.stats-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:20px;
    margin-bottom:32px;
}

.stat-card{
    background:var(--card);
    padding:24px;
    border-radius:16px;
    box-shadow:0 20px 50px rgba(0,0,0,0.4);
}

.stat-icon{
    font-size:32px;
    margin-bottom:12px;
}

.stat-label{
    font-size:13px;
    color:var(--muted);
    margin-bottom:8px;
}

.stat-value{
    font-size:28px;
    font-weight:700;
}

.card{
    background:var(--card);
    padding:28px;
    border-radius:16px;
    box-shadow:0 20px 50px rgba(0,0,0,0.4);
    margin-bottom:24px;
}

h2{
    margin:0 0 20px;
    font-size:20px;
}

table{
    width:100%;
    border-collapse:collapse;
}

th{
    text-align:left;
    font-size:13px;
    color:var(--muted);
    padding:12px;
    border-bottom:1px solid #1e2547;
}

td{
    padding:12px;
    border-bottom:1px solid #161c3b;
    font-size:14px;
}

.badge{
    padding:4px 10px;
    border-radius:6px;
    font-size:11px;
    font-weight:600;
}

.badge.active{
    background:rgba(34,197,94,0.1);
    color:var(--success);
}

.badge.inactive{
    background:rgba(239,68,68,0.1);
    color:var(--error);
}

.badge.customer{
    background:rgba(31,111,255,0.1);
    color:var(--blue-soft);
}

.badge.admin{
    background:rgba(245,158,11,0.1);
    color:var(--warning);
}

.badge.teller{
    background:rgba(139,92,246,0.1);
    color:#a78bfa;
}

.badge.auditor{
    background:rgba(236,72,153,0.1);
    color:#f472b6;
}

button{
    padding:8px 16px;
    border:none;
    border-radius:8px;
    background:linear-gradient(135deg,var(--blue),var(--blue-soft));
    color:white;
    font-weight:600;
    cursor:pointer;
    font-size:13px;
}

button:hover{
    opacity:0.9;
}

button.secondary{
    background:#1a2145;
}

button.danger{
    background:linear-gradient(135deg,#ef4444,#dc2626);
}

.logout-btn{
    padding:10px 20px;
    background:#1a2145;
    border:none;
    border-radius:12px;
    color:var(--text);
    cursor:pointer;
    font-weight:600;
}

.logout-btn:hover{
    background:#252d50;
}

.tabs{
    display:flex;
    gap:12px;
    margin-bottom:24px;
}

.tab{
    padding:12px 24px;
    background:var(--panel);
    border:none;
    border-radius:12px;
    color:var(--muted);
    cursor:pointer;
    font-weight:600;
}

.tab.active{
    background:linear-gradient(135deg,var(--blue),var(--blue-soft));
    color:white;
}

.tab-content{
    display:none;
}

.tab-content.active{
    display:block;
}

.empty-state{
    text-align:center;
    padding:40px;
    color:var(--muted);
}

.action-btns{
    display:flex;
    gap:8px;
}

input,select{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid #1e2547;
    background:var(--panel);
    color:var(--text);
    font-size:14px;
    margin-bottom:16px;
}

label{
    display:block;
    font-size:13px;
    color:var(--muted);
    margin-bottom:6px;
    font-weight:500;
}

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
}

.modal.active{
    display:flex;
}

.modal-content{
    background:var(--card);
    padding:32px;
    border-radius:16px;
    max-width:500px;
    width:100%;
}
</style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="header-left">
            <h1>Admin Dashboard</h1>
            <span class="role-badge">ADMIN</span>
        </div>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <!-- STATISTICS -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üë•</div>
            <div class="stat-label">Total Customers</div>
            <div class="stat-value" id="totalCustomers">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üè¶</div>
            <div class="stat-label">Total Accounts</div>
            <div class="stat-value" id="totalAccounts">0</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-label">Total Deposits</div>
            <div class="stat-value" id="totalDeposits">‚Ç¶0</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üí≥</div>
            <div class="stat-label">Active Loans</div>
            <div class="stat-value" id="activeLoans">0</div>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('customers')">Customers</button>
        <button class="tab" onclick="switchTab('accounts')">All Accounts</button>
        <button class="tab" onclick="switchTab('transactions')">Transactions</button>
        <button class="tab" onclick="switchTab('loans')">Loans</button>
    </div>

    <!-- CUSTOMERS TAB -->
    <div id="customers" class="tab-content active">
        <div class="card">
            <h2>Customer Management</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="customersTable">
                    <tr><td colspan="7" class="empty-state">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ACCOUNTS TAB -->
    <div id="accounts" class="tab-content">
        <div class="card">
            <h2>All Accounts</h2>
            <table>
                <thead>
                    <tr>
                        <th>Account Number</th>
                        <th>Customer</th>
                        <th>Type</th>
                        <th>Balance</th>
                        <th>Status</th>
                        <th>Date Opened</th>
                    </tr>
                </thead>
                <tbody id="accountsTable">
                    <tr><td colspan="6" class="empty-state">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- TRANSACTIONS TAB -->
    <div id="transactions" class="tab-content">
        <div class="card">
            <h2>Recent Transactions</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Type</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Amount</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="transactionsTable">
                    <tr><td colspan="6" class="empty-state">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- LOANS TAB -->
    <div id="loans" class="tab-content">
        <div class="card">
            <h2>All Loans</h2>
            <table>
                <thead>
                    <tr>
                        <th>Loan ID</th>
                        <th>Customer</th>
                        <th>Amount</th>
                        <th>Interest</th>
                        <th>Duration</th>
                        <th>Total Paid</th>
                        <th>Remaining</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="loansTable">
                    <tr><td colspan="8" class="empty-state">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- EDIT CUSTOMER MODAL -->
<div class="modal" id="editModal">
    <div class="modal-content">
        <h2>Edit Customer</h2>
        <label>Role</label>
        <select id="editRole">
            <option value="Customer">Customer</option>
            <option value="BankAdmin">Bank Admin</option>
            <option value="Teller">Teller</option>
            <option value="Auditor">Auditor</option>
        </select>
        <label>Status</label>
        <select id="editStatus">
            <option value="1">Active</option>
            <option value="0">Inactive</option>
        </select>
        <div style="display:flex;gap:10px;margin-top:16px;">
            <button onclick="saveCustomer()">Save Changes</button>
            <button class="secondary" onclick="closeModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
const API_BASE_URL = 'http://localhost:5000/api';
let currentCustomer = null;

const getToken = () => localStorage.getItem('authToken');
const getCustomer = () => JSON.parse(localStorage.getItem('customer') || '{}');

const apiCall = async (endpoint, method = 'GET', body = null) => {
    const config = {
        method,
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${getToken()}`
        }
    };
    if (body) config.body = JSON.stringify(body);
    
    const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
    const data = await response.json();
    
    if (!response.ok) throw new Error(data.message || 'Request failed');
    return data;
};

const fmt = (n) => '‚Ç¶' + parseFloat(n).toLocaleString(undefined, {minimumFractionDigits: 2});

// Check authentication and role
window.addEventListener('DOMContentLoaded', () => {
    const token = getToken();
    const customer = getCustomer();
    
    if (!token) {
        window.location.href = 'login.html';
        return;
    }
    
    if (customer.userRole !== 'BankAdmin') {
        alert('Access denied. Admin privileges required.');
        window.location.href = 'index.html';
        return;
    }
    
    loadDashboard();
});

async function loadDashboard() {
    try {
        // Load statistics
        const stats = await apiCall('/customers/dashboard');
        // This would need a special admin dashboard endpoint
        // For now, load customers
        await loadCustomers();
    } catch (error) {
        console.error('Error loading dashboard:', error);
    }
}

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    document.querySelector(`.tab[onclick*="${tab}"]`).classList.add('active');
    document.getElementById(tab).classList.add('active');
    
    // Load data for the tab
    if (tab === 'customers') loadCustomers();
    else if (tab === 'accounts') loadAccounts();
    else if (tab === 'transactions') loadTransactions();
    else if (tab === 'loans') loadLoans();
}

async function loadCustomers() {
    // Note: You'll need to create an admin route to get all customers
    const tbody = document.getElementById('customersTable');
    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Admin endpoints coming soon...</td></tr>';
}

async function loadAccounts() {
    const tbody = document.getElementById('accountsTable');
    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Admin endpoints coming soon...</td></tr>';
}

async function loadTransactions() {
    const tbody = document.getElementById('transactionsTable');
    tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Admin endpoints coming soon...</td></tr>';
}

async function loadLoans() {
    const tbody = document.getElementById('loansTable');
    tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Admin endpoints coming soon...</td></tr>';
}

function editCustomer(customerId) {
    currentCustomer = customerId;
    document.getElementById('editModal').classList.add('active');
}

function closeModal() {
    document.getElementById('editModal').classList.remove('active');
    currentCustomer = null;
}

async function saveCustomer() {
    const role = document.getElementById('editRole').value;
    const status = document.getElementById('editStatus').value === '1';
    
    try {
        // await apiCall(`/admin/customers/${currentCustomer}`, 'PUT', { role, isActive: status });
        alert('Customer updated successfully');
        closeModal();
        loadCustomers();
    } catch (error) {
        alert('Error updating customer: ' + error.message);
    }
}

function logout() {
    localStorage.clear();
    window.location.href = 'login.html';
}
</script>

</body>
</html>